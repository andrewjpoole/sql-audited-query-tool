# Monaco Tab-Based Result Tracking Architecture

**By:** Legolas (Frontend Dev)  
**Date:** 2026-02-23  
**Status:** Implemented

## Decision

Implemented per-tab query result tracking and vertically-stacked result sets display.

## Context

Users can open multiple Monaco editor tabs (via "+" button). Previously:
1. Query results were stored globally in a single `queryResult` state
2. All tabs shared the same result display—switching tabs showed the most recent result regardless of which tab ran it
3. Multiple result sets from batched queries displayed as tabs instead of stacking vertically (SSMS pattern)

This broke the mental model of tabbed editing and made multi-query investigation confusing.

## Implementation

### Per-Tab Result Storage

**Before:**
```typescript
const [queryResult, setQueryResult] = useState<QueryResult | null>(null);
```

**After:**
```typescript
const [tabResults, setTabResults] = useState<Record<string, QueryResult | null>>({});
const [activeTabId, setActiveTabId] = useState<string>('default');
const queryResult = tabResults[activeTabId] || null;
```

- Results keyed by Monaco tab ID (UUID)
- Active tab ID tracked separately
- Displayed result computed from active tab

### Tab Change Notifications

`TabbedSqlEditor` exposes:
- `getActiveTabId(): string` method on ref
- `onActiveTabChange?(tabId: string)` callback prop

Execute handlers use `editorRef.current?.getActiveTabId()` to determine storage key.

### Vertical Result Set Stacking

Removed tabbed navigation for multiple result sets. Now:
- All result sets render in vertical stack (`qr-content--stacked`)
- Each wrapped in `qr-result-set` div with header (if multi-set)
- Individual scrolling per set (max-height: 400px)
- Visual separation with borders and gaps

## Why

**Tab Isolation:** Users expect each editor tab to maintain its own context (code + results). Previous behavior violated this expectation.

**SSMS Familiarity:** SQL Server Management Studio stacks result sets vertically when running batched queries. This is the industry standard UX for SQL tools.

**Discoverability:** Vertical stacking shows all result sets at once—no hunting through tabs to find what a query returned.

## Impact

- **Users:** Can work with multiple investigation threads in parallel tabs
- **Frontend:** Result state slightly more complex but clearer ownership model
- **Backend:** No changes required
- **Performance:** Minimal—storing results per tab vs. globally is negligible

## Constraints

- Default tab ID: `'default'` (hardcoded in TabbedSqlEditor)
- Tab IDs are UUIDs generated by `uuid` library
- Results not persisted across page reload (in-memory only)
- No limit on stored results—could grow unbounded if many tabs opened
